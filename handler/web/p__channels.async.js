"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[482],{2999:function(he,K,n){n.d(K,{p:function(){return l},v:function(){return Z}});var $=n(88767),v=n(85893),l=new $.QueryClient({defaultOptions:{queries:{staleTime:30*1e3,refetchInterval:!1,refetchIntervalInBackground:!1,refetchOnWindowFocus:!1}}}),Z=function(I){var g=I.children;return(0,v.jsx)($.QueryClientProvider,{client:l,children:g})}},82250:function(he,K,n){n.d(K,{h:function(){return g}});var $=n(5574),v=n.n($),l=n(64599),Z=n.n(l),F=n(30937),I=n(82188),g=new F.YD({timeout:1e4,baseURL:"/api",withCredentials:!0});g.interceptors.request.use(function(a){if(a.headers["Content-Type"]==="multipart/form-data"){var f=new FormData;for(var p in a.data)a.data[p]!==void 0&&a.data[p]!==null&&f.append(p,a.data[p]);a.data=f}if(a.headers["Content-Type"]==="application/x-www-form-urlencoded"){var b=new URLSearchParams;for(var O in a.data)a.data[O]!==void 0&&a.data[O]!==null&&b.set(O,a.data[O]);a.data=b}return a},function(a){console.log(a),Promise.reject(a)}),g.interceptors.response.use(function(a){switch(a.status){case 200:break;case 401:I.m8.replace("/login");default:return Promise.reject(a)}return a},function(a){return a.response?console.error("API Error:",a.response.data):a.request?console.error("Network Error:",a.request):console.error("Error:",a.message),Promise.reject(a)});function _(a){if(!a)return[];var f=a.split(";"),p=[],b=_createForOfIteratorHelper(f),O;try{for(b.s();!(O=b.n()).done;){var ae=O.value,q=ae.trim().split("="),ee=_slicedToArray(q,2),le=ee[0],re=ee[1];p.push({key:le,value:re})}}catch(se){b.e(se)}finally{b.f()}return p}},120:function(he,K,n){n.r(K),n.d(K,{default:function(){return Le}});var $=n(5574),v=n.n($),l=n(67294),Z={container:"container___bXV7B",title:"title___TH1Ur",liveUrl:"liveUrl___E7uD9",m3u8:"m3u8____5PD_",playlist:"playlist___S8c1D",toolbar:"toolbar___JnoNk"},F=n(78957),I=n(5529),g=n(68872),_=n(72003),a=n(66184),f=n(56128),p=n(14726),b=n(72035),O=n(82911),ae=n(89739),q=n(10844),ee=n(4340),le=n(63606),re=n(2099),se=n(60532),je=n(99611),ge=n(86548),pe=n(48689),Pe=n(42952),Se=n(57132),Ze=n(93967),be=n.n(Ze),Oe=n(97857),ne=n.n(Oe),P=n(82250),c=n(27494),Te=n(49288),we=n(84567),S=n(88767),ve={NewChannelDialog:"NewChannelDialog___A87pQ",TsProxySelector:"TsProxySelector___q636z"},G=n(2999),e=n(85893);function Ue(t){var C=c.Z.useForm(),y=v()(C,1),s=y[0],D=(0,l.useState)(!1),M=v()(D,2),z=M[0],L=M[1],W=(0,l.useState)(!1),E=v()(W,2),N=E[0],T=E[1],R=a.default.Option,A=(0,l.useRef)(null),k=(0,l.useState)(""),J=v()(k,2),Q=J[0],w=J[1],X=(0,l.useState)(""),V=v()(X,2),U=V[0],B=V[1],Y=(0,S.useQuery)("parsers",function(){return P.h.get("/plugins").then(function(d){return JSON.parse(d.data).map(function(u){return{label:u,value:u}})})}),i=Y.data,H=(0,S.useQuery)("category",function(){return P.h.get("/category").then(function(d){var u;return((u=JSON.parse(d.data))!==null&&u!==void 0?u:[]).map(function(j){return{value:j}})})}),x=H.data,ie=(0,l.useMemo)(function(){var d,u=U.trim();return u?(d=x==null?void 0:x.filter(function(j){return j.value.includes(u)}))!==null&&d!==void 0?d:[]:x},[x,U]),m=(0,l.useMemo)(function(){return t.mode==="view"},[t.mode]);function ue(){s==null||s.validateFields().then(function(d){L(!0),t.onAdd(ne()(ne()({},d),{},{Proxy:d.Proxy&&d.Proxy!=="0",TsProxy:d.Proxy==="2"?Q:"",ProxyUrl:d.UseProxy?d.ProxyUrl:""})).then(function(){U&&!(x!=null&&x.find(function(u){return u.value===U}))&&G.p.invalidateQueries("category")}).finally(function(){L(!1)})})}(0,l.useEffect)(function(){t.visible&&(T(!1),B(""),s==null||s.resetFields(),s==null||s.setFieldValue("Parser","http"),(t.mode==="edit"||t.mode==="view")&&(s==null||s.setFieldsValue(ne()(ne()({},t.channel),{},{Proxy:t.channel.Proxy?t.channel.TsProxy?"2":"1":"0",UseProxy:!!t.channel.ProxyUrl})),T(!!t.channel.ProxyUrl),w(t.channel.TsProxy)))},[t.visible]);function te(d,u){var j=u.UseProxy;T(!!j)}return(0,e.jsx)(_.Z,{open:t.visible,onCancel:t.onCancel,onOk:m?t.onCancel:ue,cancelButtonProps:{style:{visibility:m?"hidden":"visible"}},destroyOnClose:!0,maskClosable:m,confirmLoading:z,className:ve.NewChannelDialog,title:t.mode==="add"?"New Channel":m?"View Channel":"Edit Channel",children:(0,e.jsx)("div",{style:{marginTop:20},children:(0,e.jsx)(c.Z,{labelCol:{span:6},form:s,onValuesChange:te,initialValues:{Proxy:"0"},children:(0,e.jsxs)("fieldset",{disabled:m,children:[(0,e.jsx)(c.Z.Item,{name:"ID",hidden:!0}),(0,e.jsx)(c.Z.Item,{label:"Channel Name",name:"Name",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"Channel name",allowClear:!0,readOnly:m})}),(0,e.jsx)(c.Z.Item,{label:"Live URL",name:"URL",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"URL",allowClear:!0,readOnly:m})}),(0,e.jsx)(c.Z.Item,{label:"Parser",name:"Parser",rules:[{required:!0}],children:(0,e.jsx)(a.default,{placeholder:"URL",options:i,disabled:m})}),(0,e.jsx)(c.Z.Item,{label:"Category",name:"Category",children:(0,e.jsx)(Te.Z,{placeholder:"Select or type new category names",options:ie,onSearch:B,disabled:m})}),(0,e.jsx)(c.Z.Item,{label:"Proxy stream",name:"Proxy",children:(0,e.jsxs)(a.default,{optionLabelProp:"title",disabled:m,children:[(0,e.jsx)(R,{value:"0",title:"No proxy",children:"No proxy"}),(0,e.jsx)(R,{value:"1",title:"Same as baseurl",children:"Same as baseurl"}),(0,e.jsx)(R,{value:"2",title:"Custom: "+Q,children:(0,e.jsxs)("div",{className:ve.TsProxySelector,children:[(0,e.jsx)("span",{children:"Custom:"}),(0,e.jsx)(f.Z,{ref:A,onClick:function(u){var j;u.stopPropagation(),(j=A.current)===null||j===void 0||j.focus()},onDoubleClick:function(){var u;(u=A.current)===null||u===void 0||u.select()},placeholder:"https://example.com",value:Q,onChange:function(u){return w(u.target.value)}})]})})]})}),(0,e.jsx)(c.Z.Item,{label:"Use Proxy",name:"UseProxy",valuePropName:"checked",children:(0,e.jsx)(we.Z,{})}),(0,e.jsx)(c.Z.Item,{label:"Proxy string",name:"ProxyUrl",hidden:!N,children:(0,e.jsx)(f.Z,{placeholder:"socks5://user:password@example.com:443",readOnly:m})})]})})})})}var Fe=n(75214),Ie=n(82188),Ee=n(73711),Ae=n(64576);function De(t){var C=c.Z.useForm(),y=v()(C,1),s=y[0],D=c.Z.useForm(),M=v()(D,1),z=M[0],L=(0,l.useState)("config"),W=v()(L,2),E=W[0],N=W[1];function T(){s.setFieldValue("baseurl",window.location.origin)}function R(){var i=Math.random().toString(36).substring(2);s.setFieldValue("secret",i)}var A=function(){return(0,e.jsxs)(c.Z,{labelCol:{span:6},form:s,children:[(0,e.jsx)(c.Z.Item,{name:"cmd",label:"yt-dlp Cmd",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"yt-dlp"})}),(0,e.jsx)(c.Z.Item,{name:"args",label:"yt-dlp Args",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"--extractor-args youtube:skip=dash -f b -g {url}"})}),(0,e.jsx)(c.Z.Item,{name:"baseurl",label:"BaseUrl",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:window.location.origin,suffix:(0,e.jsx)(I.Z,{title:"Autofill with current site",children:(0,e.jsx)(Ee.Z,{onClick:T})})})}),(0,e.jsx)(c.Z.Item,{name:"secret",label:"Server secret",children:(0,e.jsx)(f.Z,{suffix:(0,e.jsx)(I.Z,{title:"Randomize",children:(0,e.jsx)(Ae.Z,{onClick:R})})})}),(0,e.jsx)(c.Z.Item,{name:"apikey",label:"Data API",children:(0,e.jsx)(f.Z,{})})]})},k=function(){return(0,e.jsxs)(c.Z,{labelCol:{span:7},form:z,children:[(0,e.jsx)(c.Z.Item,{name:"password",label:"New Password",rules:[{required:!0,message:"Input your password"}],children:(0,e.jsx)(f.Z,{type:"password"})}),(0,e.jsx)(c.Z.Item,{name:"password2",label:"Repeat Password",rules:[{required:!0,message:"Repeat your password"}],children:(0,e.jsx)(f.Z,{type:"password"})})]})},J=function(){return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{children:["Based on ",(0,e.jsx)("a",{href:"https://github.com/zjyl1994/livetv",children:"LiveTV!"})," by ",(0,e.jsx)("a",{href:"https://github.com/zjyl1994",children:"zjyl1994."})]}),(0,e.jsxs)("div",{children:["Forked by ",(0,e.jsx)("a",{href:"https://github.com/snowie2000",children:"snowie2000"})]}),(0,e.jsxs)("div",{children:["Made with ",(0,e.jsx)("span",{style:{color:"#e25555"},children:"\u2665"})," in Kwangtung."]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("a",{href:"/log",target:"_blank",children:"View log"}),"\xA0\xA0\xA0|\xA0\xA0\xA0",(0,e.jsx)("a",{onClick:function(){return U.mutate()},children:"Log out"})]})]})},Q=(0,S.useQuery)("live-config",function(){return P.h.get("/getconfig").then(function(i){return JSON.parse(i.data)})},{enabled:t.visible}),w=Q.data;(0,l.useEffect)(function(){t.visible&&w&&s.setFieldsValue(w)},[w,t.visible]),(0,l.useEffect)(function(){t.visible&&N("config")},[t.visible]);var X=(0,S.useMutation)(function(i){return P.h.post("/updconfig",i,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){G.p.invalidateQueries("live-config")}}),V=(0,S.useMutation)(function(i){return P.h.post("/changepwd",i,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}),U=(0,S.useMutation)(function(){return P.h.get("/logout")},{onSuccess:function(){function H(x){document.cookie="".concat(x,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/")}H("mysession"),Ie.m8.replace("/login")}});function B(){switch(E){case"config":{s.validateFields().then(X.mutateAsync).then(function(){return t.onClose()});break}case"password":{z.validateFields().then(function(i){return i.password!==i.password2?(g.ZP.warning("Passwords do not match"),Promise.reject()):V.mutateAsync(i)}).then(function(){U.mutate(),t.onClose()});break}case"about":{t.onClose();break}}}var Y=[{label:"Config",key:"config",children:(0,e.jsx)(A,{})},{label:"Password",key:"password",children:(0,e.jsx)(k,{})},{label:"About",key:"about",children:(0,e.jsx)(J,{})}];return(0,e.jsx)(_.Z,{title:"Options",open:t.visible,onCancel:t.onClose,onOk:B,destroyOnClose:!0,children:(0,e.jsx)(Fe.Z,{items:Y,defaultActiveKey:"config",activeKey:E,onChange:N})})}var oe=[{title:"#",width:60,dataIndex:"No"},{title:"Name",width:150,dataIndex:"Name"},{title:"Live",dataIndex:"URL",render:function(C){return(0,e.jsx)("span",{className:Z.liveUrl,children:C})}},{title:"M3U8",dataIndex:"M3U8",render:function(C,y,s){var D=[(0,e.jsx)(O.Z,{style:{color:"#CCC"}}),(0,e.jsx)(ae.Z,{style:{color:"#52c41a"}}),(0,e.jsx)(q.Z,{style:{color:"#faad14"}}),(0,e.jsx)(ee.Z,{style:{color:"#ff4d4f"}}),(0,e.jsx)(q.Z,{style:{color:"#faad14"}})];return(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(I.Z,{title:(0,e.jsxs)(e.Fragment,{children:[y.Message,(0,e.jsx)("br",{}),y.LastUpdate]}),children:D[y.Status]}),(0,e.jsx)("span",{className:Z.m3u8,children:C})]})}},{title:"Proxy",width:80,render:function(C,y){return(0,e.jsxs)(F.Z,{children:[y.Proxy&&(0,e.jsx)(le.Z,{title:"Stream proxied"}),!!y.ProxyUrl&&(0,e.jsx)(re.Z,{title:"Connect via proxy"})]})}},{title:(0,e.jsx)(se.Z,{}),width:80}],Me=[{label:"M3U",value:"lives.m3u"},{label:"TXT",value:"lives.txt"}];function fe(t){return{id:t.ID,url:t.URL,name:t.Name,proxy:t.Proxy,parser:t.Parser,proxyurl:t.ProxyUrl,tsproxy:t.TsProxy,category:t.Category}}function Le(){var t=(0,l.useState)(!1),C=v()(t,2),y=C[0],s=C[1],D=(0,l.useState)(!1),M=v()(D,2),z=M[0],L=M[1],W=(0,l.useState)("add"),E=v()(W,2),N=E[0],T=E[1],R=(0,l.useState)(""),A=v()(R,2),k=A[0],J=A[1],Q=(0,l.useState)(!1),w=v()(Q,2),X=w[0],V=w[1],U=(0,l.useState)(15e3),B=v()(U,2),Y=B[0],i=B[1],H=(0,l.useState)(),x=v()(H,2),ie=x[0],m=x[1],ue=(0,l.useState)("lives.m3u"),te=v()(ue,2),d=te[0],u=te[1];(0,l.useEffect)(function(){document.title="Channel List - LiveTV!"},[]);var j=(0,S.useMutation)(function(r){return P.h.post("/newchannel",fe(r),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){G.p.invalidateQueries("channelList"),i(1e3)},onError:function(o){var h;g.ZP.error((h=o==null?void 0:o.data)!==null&&h!==void 0?h:"Unknown error")}}),Ne=(0,S.useMutation)(function(r){return P.h.get("/delchannel",{params:{id:r}})},{onSuccess:function(){G.p.invalidateQueries("channelList")},onError:function(o){var h;g.ZP.error((h=o==null?void 0:o.data)!==null&&h!==void 0?h:"Unknown error")}}),Re=(0,S.useMutation)(function(r){return P.h.post("/updatechannel",fe(r),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){G.p.invalidateQueries("channelList"),i(1e3)},onError:function(o){var h;g.ZP.error((h=o==null?void 0:o.data)!==null&&h!==void 0?h:"Unknown error")}}),me=(0,S.useQuery)("channelList",function(){return P.h.get("/channels",{responseType:"json"}).then(function(r){i(15e3);var o=JSON.parse(r.data);return Array.isArray(o)&&o.length&&(o.forEach(function(h,We){var ce;h.Parser=h.Parser||"http",h.No=We,h.Status===0&&i(1e3),(ce=h.children)!==null&&ce!==void 0&&ce.length&&h.children.some(function(ke){return ke.Status===0})&&i(1e3)}),J(o.shift().M3U8)),o!=null?o:[]})},{refetchInterval:Y,refetchOnWindowFocus:!1}),de=me.data,Qe=me.isLoading,xe=(0,l.useMemo)(function(){return k.replace("lives.m3u",d)},[d,k]);function Ve(){T("add"),s(!0)}function Be(r){return s(!1),N==="add"?j.mutateAsync(r):Re.mutateAsync(r)}function Ke(){navigator.clipboard.writeText(xe).then(function(){V(!0),setTimeout(function(){V(!1)},3e3)}).catch(function(r){console.error("Failed to copy text:",r)})}var ye=(0,l.useCallback)(function(r){m(r),T("edit"),s(!0)},[]),$e=(0,l.useCallback)(function(r){m(r),T("view"),s(!0)},[]),Ce=(0,l.useCallback)(function(r){_.Z.confirm({title:"Delete channel",content:'Do you want to delete the channel "'+r.Name+'" permanently?',okText:"Delete",cancelText:"Cancel",okType:"danger",onOk:function(){Ne.mutate(r.ID)}})},[]),ze=(0,l.useMemo)(function(){return oe[oe.length-1].render=function(r,o){return o.Virtual?(0,e.jsx)(je.Z,{onClick:function(){return $e(o)}}):(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(ge.Z,{onClick:function(){return ye(o)}}),(0,e.jsx)(pe.Z,{onClick:function(){return Ce(o)}})]})},oe},[ye,Ce]);return(0,e.jsxs)("div",{className:Z.container,children:[(0,e.jsx)("h1",{className:Z.title,children:(0,e.jsxs)(F.Z,{children:["LiveTV! ",(0,e.jsx)("small",{children:"IPTV feeds on your hand"}),(0,e.jsx)(Pe.Z,{style:{fontSize:"16px"},onClick:function(){return L(!0)}})]})}),(0,e.jsxs)("div",{className:Z.toolbar,children:[(0,e.jsxs)("div",{className:be()([Z.playlist,"flex"]),children:[(0,e.jsx)("span",{children:"Playlist:\xA0\xA0"}),(0,e.jsxs)(F.Z.Compact,{style:{flex:"1 1 99%"},children:[(0,e.jsx)(a.default,{defaultValue:"lives.m3u",value:d,onChange:u,options:Me}),(0,e.jsx)(f.Z,{value:xe,readOnly:!0}),(0,e.jsx)(I.Z,{title:X?"Copied":"Click to copy",children:(0,e.jsx)(p.ZP,{icon:(0,e.jsx)(Se.Z,{}),onClick:Ke})})]})]}),(0,e.jsx)("div",{children:(0,e.jsx)(p.ZP,{type:"primary",onClick:Ve,style:{marginLeft:"5px"},children:"New channel"})})]}),(0,e.jsx)(b.Z,{size:"middle",locale:{emptyText:(0,e.jsx)("div",{style:{textAlign:"center"},children:"No channels yet"})},scroll:{x:"100%"},rowKey:"ID",dataSource:de!=null?de:[],loading:Qe,columns:ze,pagination:{defaultPageSize:20,pageSizeOptions:[10,20,50,100],showSizeChanger:!0}}),(0,e.jsx)(Ue,{mode:N,visible:y,channel:ie,onAdd:Be,onCancel:function(){return s(!1)}}),(0,e.jsx)(De,{visible:z,onClose:function(){return L(!1)}})]})}}}]);
